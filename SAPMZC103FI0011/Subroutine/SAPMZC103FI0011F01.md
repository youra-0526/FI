``` abap
*&---------------------------------------------------------------------*
*& Include          SAPMZC103FI0011F01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*& Form get_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM get_data .

DATA: lt_garbage TYPE STANDARD TABLE OF zc103fit0001,
      ls_garbage TYPE zc103fit0001.

SELECT * INTO TABLE lt_garbage
  FROM zc103fit0001
  WHERE belnr = '1400000'
    AND gjahr = '2025'
    AND bukrs = ''.

LOOP AT lt_garbage INTO ls_garbage.

  DELETE FROM zc103fit0001
    WHERE belnr = ls_garbage-belnr
      AND gjahr = ls_garbage-gjahr
      AND bukrs = ls_garbage-bukrs.

ENDLOOP.

  SELECT belnr gjahr bldat blart budat waers bktxt mblnr bstat uscode usname approname approcode approday rejtext aedat aenam aezet
    INTO CORRESPONDING FIELDS OF TABLE gt_hbody
    FROM zc103fit0001
    WHERE bukrs = '0001'.
*    AND gjahr = gv_gjahr.

  " âœ… ê²°ì¬ ì•ˆ ëœ ì™„ê²°ì „í‘œ ì œê±° (bstat = 'B' or 'A' ì¸ë° ê²°ì¬ì •ë³´ ì—†ëŠ” ê²½ìš°)
  DELETE gt_hbody
    WHERE ( ( bstat = 'A' OR bstat = 'B' )
      AND ( approcode IS INITIAL
         OR approname IS INITIAL
         OR approday  IS INITIAL ) )
      OR ( bstat IS INITIAL ).


ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_layout
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_layout .

*-- Variant
  gs_variant-report = sy-repid.
  gs_variant-handle = 'ALV1'.

*-- Layout
  gs_toplayout-zebra      = abap_true.
  gs_toplayout-cwidth_opt = 'A'.
  gs_toplayout-sel_mode   = 'D'.
  gs_toplayout-stylefname = 'CELL_TAB'.
  gs_toplayout-ctab_fname = 'COLOR_TAB'.
  gs_toplayout-grid_title = 'ì „í‘œí—¤ë”'.

*-- Variant
  gs_variant-report = sy-repid.
  gs_variant-handle = 'ALV2'.

*-- Layout
  gs_botlayout-zebra      = abap_true.
  gs_botlayout-cwidth_opt = 'A'.
  gs_botlayout-sel_mode   = 'D'.
  gs_botlayout-grid_title = 'ì „í‘œì•„ì´í…œ'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form exclude_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM exclude_toolbar .

  DATA : ls_ui_functions TYPE ui_func.

  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_undo.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_copy_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_cut.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_delete_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_insert_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_append_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_loc_paste_new_row.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_refresh.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_auf.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_average.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_print.
  APPEND ls_ui_functions TO gt_ui_functions.
  ls_ui_functions = cl_gui_alv_grid=>mc_fc_graph.
  APPEND ls_ui_functions TO gt_ui_functions.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_object
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_object .

*--Customer conatainer
  CREATE OBJECT go_container
    EXPORTING
      container_name = 'MAIN_CONT'.

*-- í™”ë©´ë¶„í•  : Split screen
  CREATE OBJECT go_split_cont
    EXPORTING
      parent  = go_container
      rows    = 2
      columns = 1.

*-- Patch container
  CALL METHOD go_split_cont->get_container
    EXPORTING
      row       = 1
      column    = 1
    RECEIVING
      container = go_top_cont.

  CALL METHOD go_split_cont->get_container
    EXPORTING
      row       = 2
      column    = 1
    RECEIVING
      container = go_bottom_cont.

*-- Patch ALV
  CREATE OBJECT go_top_grid
    EXPORTING
      i_parent = go_top_cont.

  CREATE OBJECT go_bottom_grid
    EXPORTING
      i_parent = go_bottom_cont.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form search_data
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM search_data .

  CLEAR: gt_hbody, gt_ibody.

  IF gv_gjahr IS INITIAL.
    MESSAGE s063 DISPLAY LIKE 'E'.
    RETURN.

  ENDIF.

  CASE gv_bstat.

    WHEN ''.
      " ì „ì²´ ì¡°íšŒ
      SELECT belnr, gjahr, bldat, blart, budat, waers, bktxt, mblnr, bstat, uscode, usname ,approname, approcode, approday, rejtext, aedat, aenam, aezet
        INTO CORRESPONDING FIELDS OF TABLE @gt_hbody
        FROM zc103fit0001
       WHERE gjahr = @gv_gjahr
        AND ( bstat = 'C') OR ( ( approname <> '')  AND ( bstat = 'A' OR bstat = 'B' ) ) OR ( bstat = 'D').

    WHEN 'C'.
      SELECT belnr, gjahr, bldat, blart, budat, waers, bktxt, mblnr, bstat, uscode, usname ,approname, approcode, approday, rejtext, aedat, aenam, aezet
           INTO CORRESPONDING FIELDS OF TABLE @gt_hbody
           FROM zc103fit0001
           WHERE gjahr = @gv_gjahr
             AND bstat = 'C'.

    WHEN 'A' OR 'B'.
      SELECT belnr, gjahr, bldat, blart, budat, waers, bktxt, mblnr, bstat, uscode, usname ,approname, approcode, approday, rejtext, aedat, aenam, aezet
           INTO CORRESPONDING FIELDS OF TABLE @gt_hbody
           FROM zc103fit0001
           WHERE gjahr = @gv_gjahr
             AND bstat IN ('A', 'B')
          AND approname IS NOT NULL
          AND approcode IS NOT NULL.

      DELETE gt_hbody WHERE approname IS INITIAL OR approcode IS INITIAL.

    WHEN 'D'.
      SELECT * INTO CORRESPONDING FIELDS OF TABLE @gt_hbody
        FROM zc103fit0001
        WHERE gjahr = @gv_gjahr
          AND bstat = 'D'.

    WHEN OTHERS.
      CLEAR gt_hbody. " ì•Œ ìˆ˜ ì—†ëŠ” ê°’ì´ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh_screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> GO_TOP_GRID
*&---------------------------------------------------------------------*
FORM refresh_screen  USING po_object
                   TYPE REF TO cl_gui_alv_grid..

  DATA : ls_stable TYPE lvc_s_stbl. " ê°±ì‹  ì‹œì—ë„ ë§ˆìš°ìŠ¤ ìœ„ì¹˜ ê³ ì •

  ls_stable = VALUE #(
                         row = abap_true
                         col = abap_true
                      ).
  po_object->refresh_table_display(
    EXPORTING
      is_stable = ls_stable ).

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_status
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_status .

  LOOP AT gt_hbody ASSIGNING FIELD-SYMBOL(<fs_row>).

    CASE <fs_row>-bstat.

      WHEN 'C'. " ì„ì‹œ
        <fs_row>-status1 = icon_led_yellow && ' ì„ì‹œ'.

      WHEN 'A'. " ë¯¸ê²°
        <fs_row>-status1 = icon_led_green && ' ë¯¸ê²°'.

      WHEN 'B'. " ì™„ë£Œ
        <fs_row>-status1 = icon_led_green && ' ì™„ë£Œ'.

      WHEN 'D'. " ë°˜ë ¤
        <fs_row>-status1 = icon_led_red && ' ë°˜ë ¤'.

      WHEN OTHERS.
        <fs_row>-status1 = ''. " í˜¹ì‹œë¼ë„ ì•Œ ìˆ˜ ì—†ëŠ” ê°’ ë“¤ì–´ì˜¬ ê²½ìš°

    ENDCASE.
  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_hotspot_click
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_ROW_ID
*&      --> E_COLUMN_ID
*&---------------------------------------------------------------------*
FORM handle_hotspot_click  USING   pv_row_id
                                    pv_column_id
                                    po_sender TYPE REF TO cl_gui_alv_grid.

  DATA: lt_popup_text TYPE STANDARD TABLE OF char100,
        lv_line       TYPE char100.

  CASE pv_column_id.
    WHEN 'BELNR'.
      CLEAR: gs_hbody, gt_ibody, gs_ibody.
      READ TABLE gt_hbody INTO gs_hbody INDEX pv_row_id.

      SELECT a~bukrs belnr gjahr buzei bldat blart budat sgtxt uscode usname type_id cat_id
            bschl koart shkzg hkont wrbtr dmbtr a~waers mwskz hwbas mwsts zuonr augbl k_waers
            augdt obelnr bp_id bp_name anln1 matnr werks txt50
       INTO CORRESPONDING FIELDS OF TABLE gt_ibody
        FROM zc103fit0002 AS a LEFT OUTER JOIN zc103fit0003 AS b
       ON a~hkont = b~saknr
*    AND a~bukrs = b~bukrs
       WHERE belnr = gs_hbody-belnr
       ORDER BY buzei.

      LOOP AT gt_ibody  INTO gs_ibody.
        IF gs_ibody-shkzg = 'H'.
          gs_ibody-wrbtr = ( gs_ibody-wrbtr * -1 ).
          gs_ibody-dmbtr = ( gs_ibody-dmbtr * -1 ).
          MODIFY gt_ibody FROM gs_ibody INDEX sy-tabix.
        ENDIF.
      ENDLOOP.

      PERFORM set_gl_name.
      PERFORM refresh_screen USING go_bottom_grid.

    WHEN 'STATUS2'.

      READ TABLE gt_hbody INTO gs_hbody INDEX pv_row_id.

      IF sy-subrc = 0 AND gs_hbody-rejtext IS NOT INITIAL.

        " í…ìŠ¤íŠ¸ â†’ ì¸í„°ë„ í…Œì´ë¸”ë¡œ ë³€í™˜
        CLEAR: gt_textview.
        SPLIT gs_hbody-rejtext AT cl_abap_char_utilities=>cr_lf INTO TABLE gt_textview.

        " íŒì—… í˜¸ì¶œ
        CALL SCREEN 0102 STARTING AT 70 5 ENDING AT 145 26.
      ENDIF.

  ENDCASE.
ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_gl_name
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_gl_name .

**gl text êµ¬í•˜ê¸°
  CLEAR : gs_gltext, gt_gltext.

  SELECT saknr txt50
    INTO TABLE gt_gltext
    FROM zc103fit0003.

  " 3. ê³„ì •ëª… ë¶™ì´ê¸° (gt_gltextê°€ ì´ë¯¸ ì±„ì›Œì ¸ ìˆë‹¤ê³  ê°€ì •)

  gt_backup = gt_fit03.
  SORT gt_gltext BY saknr ASCENDING.
  DELETE ADJACENT DUPLICATES FROM gt_backup COMPARING saknr.

  LOOP AT gt_ibody INTO gs_ibody.

    gv_tabix = sy-tabix.

    READ TABLE gt_gltext INTO gs_gltext
      WITH KEY
               saknr = gs_ibody-hkont
      BINARY SEARCH.

    IF sy-subrc = 0.
      gs_ibody-txt50 = gs_gltext-txt50.
      MODIFY gt_ibody FROM gs_ibody INDEX gv_tabix TRANSPORTING txt50.
    ENDIF.

  ENDLOOP.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_item_catalog
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&      --> P_
*&---------------------------------------------------------------------*
FORM set_item_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_botfcat-key       = pv_key.
  gs_botfcat-fieldname = pv_field.
  gs_botfcat-ref_table = pv_table.
  gs_botfcat-just      = pv_just.
  gs_botfcat-emphasize = pv_emph.

  CASE pv_field.
    WHEN 'BUZEI'.
      gs_botfcat-coltext = 'í•­ëª©ë²ˆí˜¸'.
    WHEN 'BUKRS'.
      gs_botfcat-coltext = 'íšŒì‚¬ì½”ë“œ'.
    WHEN 'GJAHR'.
      gs_botfcat-coltext = 'íšŒê³„ì—°ë„'.
    WHEN 'BELNR'.
      gs_botfcat-coltext = 'ì „í‘œë²ˆí˜¸'.
    WHEN 'SHKZG'.
      gs_botfcat-coltext = 'ì°¨/ëŒ€ë³€ì§€ì‹œì'.
    WHEN 'SGTXT'.
      gs_botfcat-coltext = 'ì•„ì´í…œí…ìŠ¤íŠ¸'.
    WHEN 'TXT50'.
      gs_botfcat-coltext = 'ê³„ì •ë‚´ì—­'.
    WHEN 'WRBTR'.
      gs_botfcat-cfieldname = 'WAERS'.
      gs_botfcat-coltext = 'ì „í‘œí†µí™”'.
    WHEN 'DMBTR'.
      gs_botfcat-coltext = 'í˜„ì§€í†µí™”'.
      gs_botfcat-cfieldname = 'K_WAERS'.
    WHEN 'WAERS'.
      gs_botfcat-coltext = 'ì „í‘œí†µí™”'.
    WHEN 'K_WAERS'.
      gs_botfcat-coltext = 'í˜„ì§€í†µí™”'.

  ENDCASE.

  APPEND gs_botfcat TO gt_botfcat.
  CLEAR gs_botfcat.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh .

  CLEAR: gv_bstat, gv_gjahr.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_edit_toolbar
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_OBJECT
*&      --> E_INTERACTIVE
*&---------------------------------------------------------------------*
FORM handle_edit_toolbar  USING    po_object TYPE REF TO cl_alv_event_toolbar_set
                                   pv_interactive.

  CLEAR gs_button.
  gs_button-butn_type = '3'.
  APPEND gs_button TO po_object->mt_toolbar.

  CLEAR gs_button.
  gs_button-function  = 'PAYMENT'.
  gs_button-icon      = icon_checked.
  gs_button-quickinfo = 'ê²°ì¬'.
  gs_button-text      = TEXT-101.
  APPEND gs_button TO po_object->mt_toolbar.

  CLEAR gs_button.
  gs_button-function  = 'REJECT'.
  gs_button-icon      = icon_incomplete.
  gs_button-quickinfo = 'ë°˜ë ¤'.
  gs_button-text      = TEXT-102.
  APPEND gs_button TO po_object->mt_toolbar.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form handle_user_command
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*&      --> E_UCOMM
*&---------------------------------------------------------------------*
FORM handle_user_command  USING    pv_ucomm.

  CASE pv_ucomm.
    WHEN 'PAYMENT'.
      PERFORM payment.
    WHEN 'REJECT'.
      PERFORM upload_reject.
  ENDCASE.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form payment
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM payment .

  DATA: lt_save    TYPE TABLE OF zc103fit0001,
        ls_save    TYPE zc103fit0001,
        lt_roid    TYPE lvc_t_roid,
        ls_roid    TYPE lvc_s_roid,
        lv_answer,
        lv_number  TYPE numc5,
        lv_padded  TYPE string,
        lv_approno TYPE zc103fit0001-approcode. " ê²°ì¬ë²ˆí˜¸ íƒ€ì… ë§ì¶°ì¤˜

*-- ì„ íƒëœ í–‰ ê°€ì ¸ì˜¤ê¸°

  CALL METHOD go_top_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE 'ê²°ì¬í•  ì „í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.' TYPE 'S' DISPLAY LIKE 'E'.
    RETURN.
  ENDIF.

*-- ë°˜ë³µë¬¸ ëŒë©´ì„œ ê²°ì¬ì ì •ë³´ ì„¸íŒ…
  LOOP AT lt_roid INTO ls_roid.
    READ TABLE gt_hbody ASSIGNING FIELD-SYMBOL(<fs_hbody>) INDEX ls_roid-row_id.
    IF sy-subrc = 0.


      IF <fs_hbody>-bstat = 'B' OR <fs_hbody>-approcode IS NOT INITIAL.
        MESSAGE s072 DISPLAY LIKE 'E'.
        RETURN.
      ENDIF.

**ì´ê±° ê³ ì¹˜ì…ˆ
      IF <fs_hbody>-bstat = 'D'.
        MESSAGE s073 DISPLAY LIKE 'E'.
        RETURN.
      ENDIF.

      CALL FUNCTION 'ZC1F030001'
        EXPORTING
          iv_action = 'ê²°ì¬'
        IMPORTING
          ev_answer = lv_answer.

      IF lv_answer = '2'.  " Noë¥¼ ì„ íƒí•˜ë©´ ì¢…ë£Œ
        RETURN.
      ENDIF.

      IF lv_answer = 1.

*-- ë„˜ë²„ë ˆì¸ì§€ë¡œ approcode ì±„ë²ˆ
        CALL FUNCTION 'NUMBER_GET_NEXT'
          EXPORTING
            object        = 'ZC103FIAP'
            nr_range_nr   = '01'
            ignore_buffer = 'X'
          IMPORTING
            number        = lv_number.

        IF sy-subrc <> 0.
          MESSAGE 'ê²°ì¬ë²ˆí˜¸ ì±„ë²ˆ ì‹¤íŒ¨!' TYPE 'E'.
          RETURN.
        ENDIF.

        lv_padded     = |{ lv_number WIDTH = 5 ALIGN = RIGHT PAD = '0' }|.
        gs_hbody-approcode  = |APP{ lv_padded }|.


*-- ALV ë‚´ë¶€í…Œì´ë¸” ìˆ˜ì •
        <fs_hbody>-approname = 'ì„ë¯¸ì„œ'. "ì‚¬ìš©ì ì´ë¦„ì„ ë”°ë¡œ ë½‘ìœ¼ë ¤ë©´ ì¶”ê°€ ë¡œì§ í•„ìš”
        <fs_hbody>-approday  = sy-datum.
        <fs_hbody>-bstat     = 'B'.  " ê²°ì¬ ì™„ë£Œ ìƒíƒœ
        <fs_hbody>-approcode = |APP{ lv_padded }|.
        <fs_hbody>-modi_yn   = abap_true.
        <fs_hbody>-aedat = sy-datum.
        <fs_hbody>-aenam = sy-uname.
        <fs_hbody>-aezet = sy-uzeit.

*-- âœ… ì „í‘œì•„ì´í…œì—ì„œ BLART í™•ì¸í•´ì„œ BSTAT ìˆ˜ì •

        CLEAR gt_ibody.

        SELECT * FROM zc103fit0002
          INTO TABLE gt_ibody
          FOR ALL ENTRIES IN gt_hbody
          WHERE belnr = gt_hbody-belnr
            AND gjahr = gt_hbody-gjahr.

        LOOP AT gt_ibody INTO DATA(ls_ibody)
          WHERE belnr = <fs_hbody>-belnr
            AND gjahr = <fs_hbody>-gjahr.

          IF ls_ibody-blart = 'DR' OR ls_ibody-blart = 'KR'.
            <fs_hbody>-bstat = 'A'. " ë¯¸ê²°ë¡œ ì „í™˜
          ENDIF.

        ENDLOOP.

*-- DB í…Œì´ë¸”ë„ ì—…ë°ì´íŠ¸
        UPDATE zc103fit0001
          SET approcode = <fs_hbody>-approcode
              approname = <fs_hbody>-approname
              approday  = <fs_hbody>-approday
              bstat     = <fs_hbody>-bstat
              aedat     = <fs_hbody>-aedat
              aenam     = <fs_hbody>-aenam
              aezet     = <fs_hbody>-aezet
          WHERE belnr = <fs_hbody>-belnr
            AND gjahr = <fs_hbody>-gjahr.

      ENDIF.
    ENDIF.
  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
  ELSE.
    ROLLBACK WORK.
  ENDIF.

*-- ALV ë¦¬í”„ë ˆì‹œ
  PERFORM set_status.
  PERFORM set_status2.
  PERFORM refresh_screen USING go_top_grid.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form upload_reject
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM upload_reject .

  DATA: lt_roid TYPE lvc_t_roid,
        ls_roid TYPE lvc_s_roid.

*-- í˜„ì¬ ì„ íƒëœ ALV í–‰ ê°€ì ¸ì˜¤ê¸°
  CALL METHOD go_top_grid->get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE s065 DISPLAY LIKE 'E'. "'ë°˜ë ¤ ì²˜ë¦¬í•  ì „í‘œë¥¼ ì„ íƒí•˜ì„¸ìš”.'
    RETURN.
  ENDIF.

*-- ì—¬ëŸ¬ í–‰ì„ ì„ íƒí–ˆì„ ê²½ìš°
  IF lines( lt_roid ) > 1.
    MESSAGE s066 DISPLAY LIKE 'E'.  "'í•˜ë‚˜ì˜ í–‰ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
    RETURN.
  ENDIF.

*-- ì²« ë²ˆì§¸ ì„ íƒëœ í–‰ ê¸°ì¤€ìœ¼ë¡œ ì „í‘œë²ˆí˜¸ ì½ê¸°
  READ TABLE lt_roid INTO ls_roid INDEX 1.

  IF sy-subrc = 0.

    READ TABLE gt_hbody INTO gs_hbody INDEX ls_roid-row_id.

    IF sy-subrc = 0.

      IF gs_hbody-approcode IS NOT INITIAL.
        MESSAGE s071 DISPLAY LIKE 'E'.
        RETURN.
      ENDIF.

           IF gs_hbody-bstat = 'D'.
        MESSAGE s073 DISPLAY LIKE 'E'.
        RETURN.
      ENDIF.

      gv_belnr = gs_hbody-belnr. " â˜… ì—¬ê¸°ì„œ ì „í‘œë²ˆí˜¸ ì €ì¥!
      gv_rejday = sy-datum.
    ENDIF.
  ENDIF.

*-- íŒì—… ë„ìš°ê¸°
  PERFORM set_101screen.
  CALL SCREEN 0101 STARTING AT 70 5 ENDING AT 150 26.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form create_object_0101
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM create_object_0101 .

  IF go_text_con IS NOT BOUND.

    CREATE OBJECT go_text_con
      EXPORTING
        container_name = 'TEXT_CONT'.

    CREATE OBJECT go_text_edit
      EXPORTING
*       wordwrap_mode = 2 " cl_gui_textedit=>wordwrap_at_windowborder " 0: OFF; 1: wrap a window border; 2: wrap at fixed position
        wordwrap_mode = cl_gui_textedit=>wordwrap_at_windowborder " 0: OFF; 1: wrap a window border; 2: wrap at fixed position
        parent        = go_text_con.

*-- Text eidt Toolbar mode
    go_text_edit->set_toolbar_mode(
      EXPORTING
        toolbar_mode           = 1           " visibility of toolbar; eq 0: OFF ; ne 0: ON
    ).


  ENDIF.
ENDFORM.
*&---------------------------------------------------------------------*
*& Form save_comment
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM save_comment .

  DATA: lv_text TYPE string.

* 1. í…ìŠ¤íŠ¸ í¸ì§‘ê¸°ì—ì„œ í…ìŠ¤íŠ¸ ë°›ì•„ì˜¤ê¸°
  CALL METHOD go_text_edit->get_text_as_r3table(
    IMPORTING
      table                  = gt_text                 " text as R/3 table
    EXCEPTIONS
      error_dp               = 1                " Error while retrieving text table via DataProvider control!
      error_cntl_call_method = 2                " Error while retrieving a property from TextEdit control
      error_dp_create        = 3                " Error while creating DataProvider Control
      potential_data_loss    = 4                " Potential data loss: use get_text_as_stream instead
      OTHERS                 = 5
  ).
* 2. ë¬¸ìì—´ë¡œ ë³€í™˜

  CLEAR lv_text.

  LOOP AT gt_text ASSIGNING FIELD-SYMBOL(<fs_line>).
    lv_text = lv_text && <fs_line>-tdline && space.
  ENDLOOP.

  CONDENSE lv_text.

* 3. í•´ë‹¹ ì „í‘œì— ë°˜ë ¤ì²˜ë¦¬ ì ìš©
  LOOP AT gt_hbody ASSIGNING FIELD-SYMBOL(<fs_h>) WHERE belnr = gv_belnr.
    gv_tabix = sy-tabix.

    <fs_h>-status1 = icon_led_red && ' ë°˜ë ¤'.
    <fs_h>-status2 = icon_message_error.  " ì•„ì´ì½˜ë§Œ ë³´ì—¬ì¤Œ
    <fs_h>-bstat    = 'D'.
    <fs_h>-rejtext  = lv_text.            " ë°˜ë ¤ ì‚¬ìœ  ì €ì¥ìš© í•„ë“œ í•„ìš”
    <fs_h>-rejdate  = sy-datum.            " ë°˜ë ¤ì¼
    <fs_h>-aedat = sy-datum.
    <fs_h>-aenam = sy-uname.
    <fs_h>-aezet = sy-uzeit.

    MODIFY gt_hbody FROM <fs_h> INDEX gv_tabix .

*DBí…Œì´ë¸” ì—…ë°ì´íŠ¸

    UPDATE zc103fit0001
    SET
        bstat     = <fs_h>-bstat
        aedat     = <fs_h>-aedat
        aenam     = <fs_h>-aenam
        aezet     = <fs_h>-aezet
        rejtext   = <fs_h>-rejtext
    WHERE belnr = <fs_h>-belnr
      AND gjahr =  <fs_h>-gjahr.

  ENDLOOP.

  IF sy-subrc EQ 0.
    COMMIT WORK.
    MESSAGE s070 DISPLAY LIKE 'S'. "'ë°˜ë ¤ ì‚¬ìœ ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'
  ELSE.
    ROLLBACK WORK.
  ENDIF.

*-- ALV ë¦¬í”„ë ˆì‹œ
  PERFORM set_status.
  PERFORM set_status2.
  PERFORM refresh_screen USING go_top_grid.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_101screen
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_101screen .

*  gv_belnr = gt_hbody-belnr.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_hbodyalv
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_hbodyalv .

  gv_apppos = 'ì°¨ì¥'.
  gv_appname = 'ì„ë¯¸ì„œ'.
  gv_appno = 'ADMIN001'.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form set_sataus2
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM set_status2 .

  DATA: lt_celltab TYPE lvc_t_styl,
        lt_color   TYPE lvc_t_scol,
        ls_style   TYPE lvc_s_styl,
        ls_color   TYPE lvc_s_scol.

  LOOP AT gt_hbody ASSIGNING FIELD-SYMBOL(<fs_row>).

    CLEAR: <fs_row>-cell_tab.  " ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
    CLEAR: ls_style.

    CASE <fs_row>-bstat.
      WHEN 'C'. " ê²°ì¬ëŒ€ê¸°
        <fs_row>-status2 = 'ê²°ì¬ëŒ€ê¸°'.

      WHEN 'A' OR 'B'. " ë¯¸ê²°/ì™„ê²° â†’ ê²°ì¬ ì™„ë£Œì¸ì§€ ì²´í¬ í•„ìš”
        IF <fs_row>-approname IS NOT INITIAL AND
           <fs_row>-approcode IS NOT INITIAL AND
           <fs_row>-approday IS NOT INITIAL.
          <fs_row>-status2 = 'ê²°ì¬ì™„ë£Œ'.
        ELSE.
          CLEAR <fs_row>-status2. " ê²°ì¬ì²˜ë¦¬ ì•ˆëœ ì „í‘œ â†’ ìƒíƒœ í‘œì‹œ ì•ˆí•¨
        ENDIF.

*      WHEN 'B'. " ê²°ì¬ì™„ë£Œ
*        <fs_row>-status2 = 'ê²°ì¬ì™„ë£Œ'.
*      WHEN 'A'. " ê²°ì¬ì™„ë£Œ
*        <fs_row>-status2 = 'ê²°ì¬ì™„ë£Œ'.
      WHEN 'D'. " ë°˜ë ¤ë¨
        <fs_row>-status2 = icon_envelope_closed.   " í¸ì§€ ì•„ì´ì½˜.
        " âœ… ìŠ¤íƒ€ì¼ ì„¤ì •: STATUS2 ì…€ë§Œ í•«ìŠ¤íŒŸ ì²˜ë¦¬

        "ì˜¤ì§ ì•„ì´ì½˜ë§Œ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ í•«ìŠ¤íŒŸ ì§€ì •
        ls_style-fieldname = 'STATUS2'.
        ls_style-style     = cl_gui_alv_grid=>mc_style_hotspot.

        APPEND ls_style TO <fs_row>-cell_tab.


        " ğŸ”¹ ì…€ ë°°ê²½ ê°•ì¡° (ë¹¨ê°„ìƒ‰ ë“±)
        ls_color-fname       = 'STATUS2'.
        ls_color-color-col   = '6'.  " ë¹¨ê°•
        ls_color-color-int   = '1'.  " ê°•ì¡°
        ls_color-color-inv   = '0'.
        APPEND ls_color TO <fs_row>-color_tab.  " <-- ì—¬ê¸°ì— ë„£ê¸°

      WHEN OTHERS.
        CLEAR <fs_row>-status2.
    ENDCASE.

  ENDLOOP.

  READ TABLE gt_topfcat INTO DATA(ls_fcat) WITH KEY fieldname = 'STATUS2'.
  IF sy-subrc = 0.
    ls_fcat-just = 'C'.   " ê°€ìš´ë° ì •ë ¬
    MODIFY gt_topfcat FROM ls_fcat INDEX sy-tabix.
  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form display_text2
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM display_text2 .

  IF go_text_con2 IS NOT BOUND.

    CREATE OBJECT go_text_con2
      EXPORTING
        container_name = 'TEXT_VIEWER'.  " ìŠ¤í¬ë¦°ì— ì˜¬ë¦° ì»¤ìŠ¤í…€ ì»¨íŠ¸ë¡¤ ì´ë¦„

    CREATE OBJECT go_text_edit2
      EXPORTING
        parent        = go_text_con2
        wordwrap_mode = cl_gui_textedit=>wordwrap_at_windowborder.

    " í…ìŠ¤íŠ¸ ë„£ê¸°
    go_text_edit2->set_readonly_mode(
     EXPORTING
       readonly_mode = 1 ).

    " ğŸ”¥ ì—¬ê¸° ë¹ ì¡Œì—ˆìŒ! ë°ì´í„° ë„£ê¸°!!
    IF go_text_edit2 IS BOUND.
      go_text_edit2->set_text_as_r3table(
        EXPORTING
          table = gt_textview ).
    ENDIF.

  ENDIF.

ENDFORM.
*&---------------------------------------------------------------------*
*& Form refresh2
*&---------------------------------------------------------------------*
*& text
*&---------------------------------------------------------------------*
*& -->  p1        text
*& <--  p2        text
*&---------------------------------------------------------------------*
FORM refresh2 .
CLEAR : gt_hbody, gt_ibody, gv_gjahr, GV_BSTAT.
PERFORM refresh_screen USING go_top_grid.
PERFORM refresh_screen USING go_bottom_grid.
ENDFORM.
